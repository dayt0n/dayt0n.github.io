---
layout: post
title: Odysseus
description: "Should've saved your blobs..."
category: articles
tags: [iBEC, iBoot, iBSS, iTunes, idevicerestore, APTicket, SHSH Blobs, downgrade, A5, A6, ios-kexec-utils, kloader]
image:
    feature: APTicket_in_blob.png
---

# Disclaimer
This method currently works on just certain 32bit devices. By certain I mean only for bundles that [xerub](http://twitter.com/xerub) can create with keys he has. Also, if your SHSH blobs and APTickets are invalid in any way, this restore will fail and you will be forced to upgrade to the latest signed firmware, which may not currently be jailbreakable. [Xerub](http://twitter.com/xerub) or myself are absolutely not responsible for any damage you do to your device or current firmware. There may also be problems with the baseband if you attempt to downgrade to a firmware with a different baseband than you are currently on. Make sure you check the baseband. I cannot stress this enough. If you only know how to click a "jailbreak" button and do not know much about the underlying components of iOS, please do not try this as you will probably mess up your device. I only recommend experienced developer use this tool.

# What is this?
Odysseus is a program written by [xerub](http://twitter.com/xerub) that will downgrade your 32bit A5+ devices. This method also works on A4, but why use this on A4 when you have [limera1n](http://dayt0n.github.io/articles/what-is-limera1n/)? Anyway, this method uses a tool incuded within [winocm](http://twitter.com/winocm)'s ios-kexec-utils. The tool, kloader, is a CLI that you can run on an iOS device that loads an (decrypted) image. It requires a jailbreak currently to run kloader on the device. Odyssseus is fairly simple for the experienced user. It is a tool that allows you to bootstrap a pwned iBSS and then initiate a restore using [iDeviceRestore](https://github.com/xerub/idevicerestore) with a custom iPSW that will effectively downgrade/upgrade/restore to any firmware you have valid blobs and an APTicket for. Note: this does not change your baseband, so if you go too far up or down then the core OS will not understand the new software and YMMV. 

## Requirements
* A jailbroken with the latest untether that has tfp0 enabled. tfp0 enabled untethers include evasi0n, TaiG, and the latest Pangu. For example, early versions of Pangu did not have tfp0 enabled. 

* OpenSSH installed on target device

* Valid SHSH blobs with valid APTickets. Odysseus comes with a native SHSH blob validator called `validate`.

## Other Options
If for some reason, you would like to go back to the firmware that is currently installed on your device, well, Odysseus has you covered there as well with a method to grab on-device blobs from any 32bit device! After you have completed Step 4: Building the Custom iPSW in the main instructions, continue with these directions:

### Extract iBEC
  
  {% highlight c %}
User$ mv `unzip -j custom.ipsw 'Firmware/dfu/iBEC*' | awk '/inflating/{print $2}'` pwnediBEC
  {% endhighlight %}

### Boot PWNed
  {% highlight c %}
User$ ./sshtool -k ../kloader -b pwnediBSS -p 22 deviceIP
  {% endhighlight %}

Wait for the device to enter DFU Mode. Then upload the iBEC you extracted previously:

  {% highlight c %}
User$ ./irecovery -f pwnediBEC
  {% endhighlight %}

Wait for the device to enter what seems like recovery mode (should have a blank, lit screen)

### Grab those Blobs!

Now, you have to execute a few commands with iRecovery:

  {% highlight c %}
User$ ./irecovery -s
iRecovery> /send ../payload
iRecovery> go blobs
iRecovery> /exit
User$ ./irecovery -g myblob.dump
User$ ./irecovery -s
iRecovery> reboot
  {% endhighlight %}

### Unpack/Validate Blobs
You must download an iPSW file of the firmware you are currently on now.

  {% highlight c %}
User$ ./ticket myblob.dump myblob.plist matching.ipsw -z
User$ ./validate myblob.plist matching.ipsw -z
  {% endhighlight %}

If everything checks out and is valid, that means: Yay! It worked! Now you have a fallback to a still jailbreakable version of iOS in case you do not like your downgrade.

## Instructions

### 1. Download the iPSW file you want to downgrade to [here](http://ipsw.me). 

### 2. Validate the Blob(s)
* Convert the .shsh file you have to the xml format and validate:

  {% highlight c %}
User$ zcat myblob.shsh > myblob.plist
User$ plutil -convert xml1 myblob.plist
User$ ./validate myblob.plist downloaded.ipsw -z
  {% endhighlight %}

  * If you get a bunch of "ERROR"s then, the blob/ticket is not valid, and you should stop now and do not try to downgrade. "WARNING"s are fine.

### 3. Save your Baseband
* Enter your SSH password. The default password is `alpine`:
{% highlight c %}
User$ ./sshtool -s baseband.tar -p 22 deviceIP
{% endhighlight %}

* If baseband.tar is 0 bytes, that is fine; it probably means your device does not have the baseband on the main filesystem. Any other error, however is bad. 

### 4. Build the custom iPSW
* This may take a while.. Use the `-memory` parameter only if your computer has greater than or equal to four gigabytes of RAM. Also make sure you have the correct bundle in FirmwareBundles/. If the bundle you want is not there, [ask for it](http://twitter.com/home/?status=@xerub Could you please create a bundle for this device model and firmware: ). 

  {% highlight c %}
  User$ ./ipsw downloaded.ipsw custom.ipsw -memory baseband.tar 
  {% endhighlight %}

  * Extract the iBSS from the custom iPSW you just built.
  
  {% highlight c %}
User$ ./xpwntool `unzip -j custom.ipsw 'Firmware/dfu/iBSS*' | awk '/inflating/{print $2}'` pwnediBSS
  {% endhighlight %}

### 5. SSH into the device and execute kloader as follows: 

{% highlight c %}
User$ ./sshtool -k ../kloader -b pwnediBSS -p 22 deviceIP
{% endhighlight %}

* Wait for the device to enter DFU mode. If iTunes doesn't recognize it within a 2 minutes, unplug and plug back in, but DO NOT press any buttons. Once iTunes recognizes it, kill iTunes. If iTunes doesn't recognize it after roughly 5 minutes, do a hard reset by holding the home + power button until the Apple Logo appears. 

### 6. Make sure the desired VALID SHSH blob is in shsh/ECID.shsh. Then restore to the custom iPSW using idevicerestore.

* Note: You may need to be root to access USB.

{% highlight c %}
User$ killall iTunesHelper
User$ ./idevicerestore -d -w custom.ipsw
{% endhighlight %}

### 8. Enjoy your downgraded device! If you followed all the instructions to a key, you will be alright, if not, you may be forced to restore to the currently signed, possibly non-jailbreakable firmware. 


# Credits

* [@xerub](http://twitter.com/xerub) for this wonderful package

* [@planetbeing](http://twitter.com/planetbeing) for xpwn

* [@wincom](http://twitter.com/winocm) for ios-kexec-utils

* [@libimobiledev](http://twitter.com/libimobiledev) for idevicerestore

* [@westbaer](https://github.com/westbaer) for irecovery

* [@iH8sn0w](http://twitter.com/iH8sn0w) for some ideas and code

* [@citrusui](http://twitter.com/citrusui) for the cool name

* [@JonathanSeals](http://twitter.com/JonathanSeals) for some ideas and testing

* [@daytonhasty](http://twitter.com/daytonhasty) for exchanging ideas, testing, and writeup

<center><h3>-dayt0n</h3></center>